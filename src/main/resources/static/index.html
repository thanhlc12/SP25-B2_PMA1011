<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Quản lý sản phẩm</title>
    <style>
        table P{width: 100%; border-collapse: collapse;}
        th, td {border: 1px solid #111; padding: 10px; text-align: left;}
        th {background-color: aliceblue;}
    </style>
</head>
<body>
<h2>Quản lý sản phẩm</h2>
<form id="sanPhamForm">
    <input type="hidden" id="id">
    <input type="text" id="ma" placeholder="Mã sản phẩm" required> <br><br>
    <input type="text" id="ten" placeholder="Tên sản phẩm" required> <br><br>
    <input type="number" id="soLuong" placeholder="Số lượng" min="1" required> <br><br>
    <input type="text" id="moTa" placeholder="Mô tả"> <br><br>
    <label>
        <input type="radio" name="trangThai" value="true" required> Còn kinh doanh
    </label>
    <label>
        <input type="radio" name="trangThai" value="false"> Ngừng kinh doanh
    </label>
    <br><br>
    <button type="submit">Lưu</button>
</form>

<table border="1">
    <thead>
    <tr>
        <th>ID</th>
        <th>Mã sản phẩm</th>
        <th>Tên sản phẩm</th>
        <th>Số lượng</th>
        <th>Mô tả</th>
        <th>Trạng thái</th>
        <th>Hành động</th>
    </tr>
    </thead>
    <tbody id="sanPhamTable"></tbody>
</table>

<script>
    const API_BASE = 'http://localhost:8080/api/sanPham';

    async function fetchSanPham() {
        const response = await fetch(API_BASE);
        const sanPham = await response.json();
        document.getElementById('sanPhamTable').innerHTML = sanPham.map(sp => `
                <tr>
                    <td>${sp.id}</td>
                    <td>${sp.maSanPham}</td>
                    <td>${sp.tenSanPham}</td>
                    <td>${sp.soLuong}</td>
                    <td>${sp.moTa || 'Không có mô tả'}</td>
                    <td>${sp.trangThai ? 'Còn kinh doanh' : 'Ngừng kinh doanh'}</td>
                    <td>
                        <button onclick="editSanPham(${sp.id}, '${sp.maSanPham}', '${sp.tenSanPham}', ${sp.soLuong}, '${sp.moTa || ''}', ${sp.trangThai})">Edit</button>
                        <button onclick="deleteSanPham(${sp.id})">Delete</button>
                    </td>
                </tr>
            `).join('');
    }

    function editSanPham(id, ma, ten, soLuong, moTa, trangThai) {
        document.getElementById('id').value = id;
        document.getElementById('ma').value = ma;
        document.getElementById('ten').value = ten;
        document.getElementById('soLuong').value = soLuong;
        document.getElementById('moTa').value = moTa || '';
        document.querySelector(`input[name='trangThai'][value='${trangThai}']`).checked = true;
    }

    async function deleteSanPham(id) {
        if (confirm('Bạn có chắc chắn muốn xóa không?')) {
            await fetch(`${API_BASE}/${id}`, { method: 'DELETE' });
            alert('Xóa thành công!');
            fetchSanPham();
        }
    }

    async function saveSanPham(event) {
        event.preventDefault();
        const id = document.getElementById('id').value.trim();
        const sanPham = {
            id: id ? parseInt(id) : null,
            maSanPham: document.getElementById('ma').value.trim(),
            tenSanPham: document.getElementById('ten').value.trim(),
            soLuong: parseInt(document.getElementById('soLuong').value) || 0,
            moTa: document.getElementById('moTa').value.trim(),
            trangThai: document.querySelector("input[name='trangThai']:checked").value === 'true'
        };

        const method = id ? 'PUT' : 'POST';
        const url = id ? `${API_BASE}/${id}` : API_BASE;

        await fetch(url, {
            method: method,
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(sanPham)
        });
        alert(id ? 'Cập nhật thành công!' : 'Thêm mới thành công!');
        document.getElementById('sanPhamForm').reset();
        fetchSanPham();
    }

    document.getElementById('sanPhamForm').addEventListener('submit', saveSanPham);
    fetchSanPham();
</script>
</body>
</html>
